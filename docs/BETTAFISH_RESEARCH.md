# BettaFish é¡¹ç›®è°ƒç ”æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚å†µ

**é¡¹ç›®åç§°**ï¼šBettaFishï¼ˆå¾®èˆ†ï¼‰  
**é¡¹ç›®é“¾æ¥**ï¼šhttps://github.com/666ghj/BettaFish  
**æ ¸å¿ƒå®šä½**ï¼šå¤šæ™ºèƒ½ä½“èˆ†æƒ…åˆ†æç³»ç»Ÿ  
**æŠ€æœ¯æ ˆ**ï¼šçº¯ Pythonï¼Œä»0å®ç°ï¼Œä¸ä¾èµ–ä»»ä½•æ¡†æ¶  
**å¼€æºè®¸å¯**ï¼šGPL-2.0  
**é¡¹ç›®çŠ¶æ€**ï¼šæ´»è·ƒå¼€å‘ä¸­ï¼ˆ35+ è´¡çŒ®è€…ï¼Œ4ä¸ªReleaseï¼‰

### é¡¹ç›®ç®€ä»‹

BettaFish æ˜¯ä¸€ä¸ªåˆ›æ–°å‹çš„å¤šæ™ºèƒ½ä½“èˆ†æƒ…åˆ†æç³»ç»Ÿï¼Œé€šè¿‡ Agent åä½œæœºåˆ¶ï¼Œå…¨è‡ªåŠ¨åˆ†æ 30+ ä¸»æµç¤¾äº¤åª’ä½“ä¸æ•°ç™¾ä¸‡æ¡å¤§ä¼—è¯„è®ºã€‚ç”¨æˆ·åªéœ€åƒèŠå¤©ä¸€æ ·æå‡ºåˆ†æéœ€æ±‚ï¼Œç³»ç»Ÿå³å¯ç”Ÿæˆä¸“ä¸šçš„èˆ†æƒ…åˆ†ææŠ¥å‘Šã€‚

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„åˆ†æ

### 1. å¤š Agent åä½œæ¶æ„

BettaFish é‡‡ç”¨äº†**äº”å¤§ä¸“ä¸š Agent** çš„åä½œæ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ForumEngineï¼ˆåä½œå±‚ï¼‰             â”‚
â”‚        Agent "è®ºå›" åä½œæœºåˆ¶ + ä¸»æŒäºº         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query   â”‚    â”‚  Media   â”‚    â”‚ Insight â”‚
â”‚ Agent   â”‚    â”‚  Agent   â”‚    â”‚ Agent   â”‚
â”‚         â”‚    â”‚          â”‚    â”‚         â”‚
â”‚ æ–°é—»æœç´¢ â”‚    â”‚ å¤šæ¨¡æ€   â”‚    â”‚ æ•°æ®åº“  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Report  â”‚
              â”‚  Agent   â”‚
              â”‚          â”‚
              â”‚ æŠ¥å‘Šç”Ÿæˆ  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹æ€§**ï¼š
- **Query Agent**ï¼šå›½å†…å¤–æ–°é—»å¹¿åº¦æœç´¢
- **Media Agent**ï¼šå¤šæ¨¡æ€å†…å®¹åˆ†æï¼ˆè§†é¢‘ã€å›¾ç‰‡ï¼‰
- **Insight Agent**ï¼šç§æœ‰æ•°æ®åº“æ·±åº¦æŒ–æ˜
- **Report Agent**ï¼šæ™ºèƒ½æŠ¥å‘Šç”Ÿæˆï¼ˆå¤šè½®è¿­ä»£ï¼‰
- **Forum Agent**ï¼šåä½œä¸»æŒäººï¼Œé€šè¿‡"è®ºå›"æœºåˆ¶è¿›è¡Œé“¾å¼æ€ç»´ç¢°æ’ä¸è¾©è®º

### 2. æ¨¡å—åŒ–åˆ†å±‚è®¾è®¡

æ¯ä¸ª Agent éƒ½é‡‡ç”¨ç»Ÿä¸€çš„åˆ†å±‚ç»“æ„ï¼š

```
Agent/
â”œâ”€â”€ agent.py              # Agent ä¸»é€»è¾‘
â”œâ”€â”€ llms/                 # LLM æ¥å£å°è£…
â”‚   â””â”€â”€ base.py          # ç»Ÿä¸€çš„ OpenAI å…¼å®¹å®¢æˆ·ç«¯
â”œâ”€â”€ nodes/                # å¤„ç†èŠ‚ç‚¹
â”‚   â”œâ”€â”€ base_node.py     # åŸºç¡€èŠ‚ç‚¹ç±»
â”‚   â”œâ”€â”€ search_node.py   # æœç´¢èŠ‚ç‚¹
â”‚   â”œâ”€â”€ formatting_node.py
â”‚   â””â”€â”€ summary_node.py
â”œâ”€â”€ tools/                # å·¥å…·é›†ï¼ˆå¯å®šåˆ¶ï¼‰
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ state/                # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ state.py
â””â”€â”€ prompts/              # æç¤ºè¯æ¨¡æ¿
    â””â”€â”€ prompts.py
```

**ä¼˜åŠ¿**ï¼š
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- æ˜“äºæ‰©å±•å’Œæ›¿æ¢
- ç»Ÿä¸€çš„æ¥å£æ ‡å‡†

### 3. æ•°æ®æµæ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ QueryEngineï¼ˆæœç´¢æ–°é—»ï¼‰
         â†“
         MediaEngineï¼ˆæå–å¤šæ¨¡æ€å†…å®¹ï¼‰
         â†“
         InsightEngineï¼ˆæŒ–æ˜ç§æœ‰æ•°æ®ï¼‰
         â†“
         ForumEngineï¼ˆAgent åä½œè¾©è®ºï¼‰
         â†“
         ReportEngineï¼ˆç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šï¼‰
```

---

## ğŸ¯ å¯å€Ÿé‰´çš„æ ¸å¿ƒç‰¹æ€§

### 1. â­ Agent "è®ºå›" åä½œæœºåˆ¶ï¼ˆ**å¼ºçƒˆæ¨è**ï¼‰

**åŸç†**ï¼š
- ä¸ºä¸åŒ Agent èµ‹äºˆç‹¬ç‰¹çš„å·¥å…·é›†ä¸æ€ç»´æ¨¡å¼
- å¼•å…¥**è¾©è®ºä¸»æŒäººæ¨¡å‹**ï¼ˆ`ForumEngine/monitor.py`ï¼‰
- é€šè¿‡"è®ºå›"æœºåˆ¶è¿›è¡Œé“¾å¼æ€ç»´ç¢°æ’ä¸è¾©è®º
- é¿å…å•ä¸€æ¨¡å‹çš„æ€ç»´å±€é™ä¸äº¤æµå¯¼è‡´çš„åŒè´¨åŒ–

**é€‚ç”¨åœºæ™¯ï¼ˆPaperBotï¼‰**ï¼š
```
ResearchAgentï¼ˆè®ºæ–‡åˆ†æï¼‰
    â†“
CodeAnalysisAgentï¼ˆä»£ç åˆ†æï¼‰
    â†“
QualityAgentï¼ˆè´¨é‡è¯„ä¼°ï¼‰
    â†“
ForumCoordinatorï¼ˆä¸»æŒäººï¼‰
    â†“
DocumentationAgentï¼ˆæ–‡æ¡£ç”Ÿæˆï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- åˆ›å»º `ForumCoordinator` ä½œä¸ºä¸»æŒäºº
- å®šä¹‰ Agent é—´çš„é€šä¿¡åè®®ï¼ˆ`utils/forum_reader.py`ï¼‰
- å®ç°æ—¥å¿—ç›‘æ§å’Œè®ºå›ç®¡ç†ï¼ˆ`ForumEngine/monitor.py`ï¼‰

### 2. â­ ç»Ÿä¸€çš„æ¨¡å—åŒ– Agent æ¡†æ¶

**æ ¸å¿ƒç»„ä»¶**ï¼š

```python
# base_agent.py ç»Ÿä¸€æ¥å£
class BaseAgent(ABC):
    def __init__(self, config):
        self.config = config
        self.llm = self._init_llm()      # LLM å®¢æˆ·ç«¯
        self.nodes = self._init_nodes()  # å¤„ç†èŠ‚ç‚¹
        self.tools = self._init_tools()  # å·¥å…·é›†
        self.state = {}                  # çŠ¶æ€ç®¡ç†
    
    @abstractmethod
    async def process(self, input_data):
        """ä¸»å¤„ç†æµç¨‹"""
        pass
```

**èŠ‚ç‚¹åŒ–å¤„ç†**ï¼ˆNodesï¼‰ï¼š

```python
# nodes/base_node.py
class BaseNode:
    def __init__(self, llm, tools):
        self.llm = llm
        self.tools = tools
    
    async def execute(self, state):
        """æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘"""
        pass
```

**é€‚ç”¨äº PaperBot**ï¼š
- å°†ç°æœ‰çš„ `BaseAgent` æ‰©å±•ä¸ºå®Œæ•´çš„èŠ‚ç‚¹åŒ–æ¶æ„
- æ¯ä¸ª Agent æ‹¥æœ‰ç‹¬ç«‹çš„ `nodes/`ã€`tools/`ã€`prompts/`
- ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†æœºåˆ¶

### 3. â­ ä¸­é—´ä»¶é›†æˆæœºåˆ¶

BettaFish ä¸ä»…ä¾èµ– LLMï¼Œè¿˜èåˆäº†å¤šç§ä¸­é—´ä»¶ï¼š

**æƒ…æ„Ÿåˆ†æä¸­é—´ä»¶**ï¼š
```python
# tools/sentiment_analyzer.py
class SentimentAnalyzer:
    """å¾®è°ƒ BERT/GPT-2 æ¨¡å‹è¿›è¡Œæƒ…æ„Ÿåˆ†æ"""
    def analyze(self, text):
        # è°ƒç”¨å¾®è°ƒæ¨¡å‹
        pass
```

**å…³é”®è¯ä¼˜åŒ–ä¸­é—´ä»¶**ï¼š
```python
# tools/keyword_optimizer.py
class KeywordOptimizer:
    """ä½¿ç”¨ Qwen ä¼˜åŒ–å…³é”®è¯"""
    def optimize(self, keywords):
        pass
```

**é€‚ç”¨äº PaperBot**ï¼š
- é›†æˆä»£ç è´¨é‡åˆ†ææ¨¡å‹ï¼ˆå¦‚ CodeBERTï¼‰
- æ·»åŠ æ¼æ´æ£€æµ‹æ¨¡å‹
- ä½¿ç”¨å¾®è°ƒæ¨¡å‹è¿›è¡Œè®ºæ–‡åˆ†ç±»

### 4. â­ ReportEngine çš„ IRï¼ˆä¸­é—´è¡¨ç¤ºï¼‰æ¶æ„

**æ ¸å¿ƒè®¾è®¡**ï¼š

BettaFish çš„ `ReportEngine` é‡‡ç”¨äº†**æ–‡æ¡£ä¸­é—´è¡¨ç¤ºï¼ˆDocument IRï¼‰**æ¶æ„ï¼š

```
æµç¨‹ï¼šLLM ç”Ÿæˆ â†’ JSON Schema æ ¡éªŒ â†’ IR è£…è®¢ â†’ å¤šæ ¼å¼æ¸²æŸ“
```

**å…³é”®æ¨¡å—**ï¼š

```python
# ir/schema.py - å®šä¹‰æ ‡å‡†å—ç±»å‹
BLOCK_TYPES = {
    'heading', 'paragraph', 'list', 
    'table', 'chart', 'code', 'quote'
}

# ir/validator.py - æ ¡éªŒç« èŠ‚ JSON ç»“æ„
def validate_chapter(chapter_json):
    """ç¡®ä¿ LLM è¾“å‡ºç¬¦åˆæ ‡å‡†"""
    pass

# core/stitcher.py - è£…è®¢å™¨
def stitch_document(chapters):
    """å°†å¤šä¸ªç« èŠ‚è£…è®¢ä¸ºå®Œæ•´æ–‡æ¡£"""
    pass

# renderers/ - å¤šæ ¼å¼æ¸²æŸ“å™¨
html_renderer.py   # IR â†’ HTML
pdf_renderer.py    # HTML â†’ PDF
```

**å¤šè½®ç”Ÿæˆæµç¨‹**ï¼š

```python
# nodes/template_selection_node.py
# 1. æ¨¡æ¿é€‰æ‹©
templates = select_templates(user_query)

# nodes/document_layout_node.py  
# 2. æ–‡æ¡£å¸ƒå±€è®¾è®¡
layout = design_layout(templates)

# nodes/word_budget_node.py
# 3. ç¯‡å¹…è§„åˆ’
budget = plan_word_budget(layout)

# nodes/chapter_generation_node.py
# 4. ç« èŠ‚çº§ JSON ç”Ÿæˆ + æ ¡éªŒ
for section in layout:
    chapter_json = generate_chapter(section, budget)
    validate_chapter(chapter_json)  # æ ¡éªŒ
    chapters.append(chapter_json)

# core/stitcher.py
# 5. è£…è®¢ä¸ºå®Œæ•´æ–‡æ¡£
document_ir = stitch_document(chapters)

# renderers/
# 6. æ¸²æŸ“ä¸º HTML/PDF
html = render_html(document_ir)
pdf = render_pdf(html)
```

**é€‚ç”¨äº PaperBot**ï¼š
- ä¸ºè®ºæ–‡åˆ†ææŠ¥å‘Šå®šä¹‰ JSON Schema
- å®ç°å¤šè½®æŠ¥å‘Šç”Ÿæˆï¼ˆæ¦‚è¿° â†’ ä»£ç åˆ†æ â†’ è´¨é‡è¯„ä¼° â†’ æ€»ç»“ï¼‰
- æ”¯æŒå¯¼å‡ºä¸º Markdown/HTML/PDF

### 5. â­ å·¥å…·é›†å¯å®šåˆ¶åŒ–è®¾è®¡

æ¯ä¸ª Agent çš„ `tools/` ç›®å½•éƒ½æ˜¯å¯æ’æ‹”çš„ï¼š

```python
# QueryEngine/tools/
â”œâ”€â”€ baidu_search.py      # ç™¾åº¦æœç´¢
â”œâ”€â”€ bing_search.py       # Bing æœç´¢
â”œâ”€â”€ google_search.py     # Google æœç´¢
â””â”€â”€ serper_search.py     # Serper API

# ä½¿ç”¨æ—¶åŠ¨æ€åŠ è½½
class QueryAgent:
    def _init_tools(self):
        enabled_tools = self.config.get('enabled_tools', [])
        return {
            name: import_tool(name) 
            for name in enabled_tools
        }
```

**é€‚ç”¨äº PaperBot**ï¼š
- ä¸º `ResearchAgent` æ·»åŠ å¤šç§è®ºæ–‡æœç´¢å·¥å…·ï¼ˆACMã€IEEEã€arXivï¼‰
- ä¸º `CodeAnalysisAgent` æ·»åŠ å¤šç§ä»£ç åˆ†æå·¥å…·ï¼ˆSonarQubeã€Pylintï¼‰
- é€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€å¯ç”¨/ç¦ç”¨å·¥å…·

### 6. â­ Prompt æ¨¡æ¿åŒ–ç®¡ç†

BettaFish å°†æ‰€æœ‰ Prompt é›†ä¸­ç®¡ç†ï¼š

```python
# prompts/prompts.py
TEMPLATE_SELECTION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ¥å‘Šæ¨¡æ¿é€‰æ‹©ä¸“å®¶...
ä»»åŠ¡ï¼š{task}
å¯ç”¨æ¨¡æ¿ï¼š{templates}
è¯·é€‰æ‹©æœ€é€‚åˆçš„æ¨¡æ¿...
"""

CHAPTER_GENERATION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„{section_type}ç« èŠ‚æ’°å†™ä¸“å®¶...
ä¸»é¢˜ï¼š{topic}
å­—æ•°é¢„ç®—ï¼š{word_budget}
è¾“å‡ºæ ¼å¼ï¼šä¸¥æ ¼çš„ JSON Schema
...
"""
```

**é€‚ç”¨äº PaperBot**ï¼š
- ä¸ºä¸åŒåˆ†æä»»åŠ¡è®¾è®¡ä¸“é—¨çš„ Prompt
- é›†ä¸­ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ Prompt
- æ”¯æŒ A/B æµ‹è¯•ä¸åŒçš„ Prompt ç­–ç•¥

### 7. Streamlit å• Agent ç‹¬ç«‹åº”ç”¨

BettaFish ä¸ºæ¯ä¸ª Agent æä¾›äº†ç‹¬ç«‹çš„ Streamlit åº”ç”¨ï¼š

```python
# SingleEngineApp/query_engine_streamlit_app.py
def main():
    st.title("Query Engine - æ–°é—»æœç´¢åˆ†æ")
    
    query = st.text_input("è¾“å…¥æœç´¢å…³é”®è¯")
    if st.button("å¼€å§‹åˆ†æ"):
        with st.spinner("æ­£åœ¨æœç´¢..."):
            result = query_agent.process(query)
        st.json(result)
```

**é€‚ç”¨äº PaperBot**ï¼š
- ä¸ºæ¯ä¸ª Agent åˆ›å»ºç‹¬ç«‹çš„è°ƒè¯•ç•Œé¢
- æ–¹ä¾¿å¼€å‘è€…å•ç‹¬æµ‹è¯•å’Œè°ƒä¼˜
- é™ä½å¼€å‘å’Œè°ƒè¯•å¤æ‚åº¦

### 8. ç»Ÿä¸€çš„é…ç½®ç®¡ç†

BettaFish ä½¿ç”¨ `.env` æ–‡ä»¶ç»Ÿä¸€ç®¡ç†é…ç½®ï¼š

```python
# config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # LLM é…ç½®
    OPENAI_API_KEY: str
    OPENAI_BASE_URL: str
    OPENAI_MODEL: str
    
    # æ•°æ®åº“é…ç½®
    DATABASE_URL: str
    
    # çˆ¬è™«é…ç½®
    CRAWLER_THREADS: int = 10
    
    class Config:
        env_file = ".env"

settings = Settings()
```

**é€‚ç”¨äº PaperBot**ï¼š
- ä½¿ç”¨ Pydantic è¿›è¡Œç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç†
- ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§ï¼š`.env` < é…ç½®æ–‡ä»¶ < å‘½ä»¤è¡Œå‚æ•°
- æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼ˆdev/staging/prodï¼‰

---

## ğŸ”„ ä¸ PaperBot çš„å¯¹æ¯”åˆ†æ

| ç»´åº¦ | BettaFish | PaperBotï¼ˆç°çŠ¶ï¼‰ | å¯å€Ÿé‰´ç‚¹ |
|------|-----------|-----------------|---------|
| **Agent æ¶æ„** | 5ä¸ªä¸“ä¸š Agent + è®ºå›åä½œ | 4ä¸ªåŸºç¡€ Agent | âœ… è®ºå›åä½œæœºåˆ¶ |
| **æ¨¡å—åŒ–ç¨‹åº¦** | æé«˜ï¼ˆnodes/tools/promptsï¼‰ | ä¸­ç­‰ | âœ… èŠ‚ç‚¹åŒ–æ¶æ„ |
| **ä¸­é—´ä»¶é›†æˆ** | å¾®è°ƒæ¨¡å‹ + ç»Ÿè®¡æ¨¡å‹ | ä»… LLM | âœ… é›†æˆä¸“ä¸šæ¨¡å‹ |
| **æŠ¥å‘Šç”Ÿæˆ** | IR + å¤šè½®ç”Ÿæˆ + å¤šæ ¼å¼å¯¼å‡º | - | âœ… IR æ¶æ„ + PDF å¯¼å‡º |
| **å·¥å…·é›†** | å¯æ’æ‹” | è€¦åˆåº¦è¾ƒé«˜ | âœ… å·¥å…·æ’ä»¶åŒ– |
| **é…ç½®ç®¡ç†** | ç»Ÿä¸€ .env | YAML + ä»£ç æ··åˆ | âœ… Pydantic ç»Ÿä¸€ç®¡ç† |
| **ç‹¬ç«‹è°ƒè¯•** | Streamlit å• Agent åº”ç”¨ | - | âœ… ç‹¬ç«‹è°ƒè¯•ç•Œé¢ |
| **æ•°æ®å¤„ç†** | çˆ¬è™« + æ•°æ®åº“ + æƒ…æ„Ÿåˆ†æ | è®ºæ–‡ä¸‹è½½ | âš ï¸ æ•°æ®ç®¡é“è®¾è®¡ |

---

## ğŸ“Š è¿ç§»ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰

1. **Agent è®ºå›åä½œæœºåˆ¶**
   - åˆ›å»º `ForumCoordinator` ä½œä¸ºä¸»æŒäºº
   - å®ç° Agent é—´é€šä¿¡åè®®
   - å¼•å…¥è¾©è®ºæœºåˆ¶æå‡åˆ†æè´¨é‡
   
2. **èŠ‚ç‚¹åŒ– Agent æ¶æ„**
   - é‡æ„ `BaseAgent` ä¸ºèŠ‚ç‚¹åŒ–è®¾è®¡
   - ç»Ÿä¸€ `nodes/`ã€`tools/`ã€`prompts/` ç»“æ„
   - å®ç°çŠ¶æ€ç®¡ç†æœºåˆ¶

3. **Prompt æ¨¡æ¿åŒ–ç®¡ç†**
   - åˆ›å»º `prompts/` ç›®å½•é›†ä¸­ç®¡ç†
   - ä¸ºä¸åŒä»»åŠ¡è®¾è®¡ä¸“é—¨çš„ Prompt
   - ç‰ˆæœ¬æ§åˆ¶å’Œ A/B æµ‹è¯•

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆçŸ­æœŸè§„åˆ’ï¼‰

4. **Report IR æ¶æ„**
   - å®šä¹‰è®ºæ–‡åˆ†ææŠ¥å‘Šçš„ JSON Schema
   - å®ç°å¤šè½®æŠ¥å‘Šç”Ÿæˆæµç¨‹
   - æ”¯æŒ PDF/HTML å¯¼å‡º

5. **å·¥å…·é›†æ’ä»¶åŒ–**
   - é‡æ„ä¸ºå¯æ’æ‹”çš„å·¥å…·æ¶æ„
   - æ”¯æŒé€šè¿‡é…ç½®åŠ¨æ€åŠ è½½å·¥å…·
   - ä¸ºæ¯ä¸ª Agent è®¾è®¡ä¸“å±å·¥å…·é›†

6. **ç»Ÿä¸€é…ç½®ç®¡ç†**
   - ä½¿ç”¨ Pydantic æ›¿ä»£ YAML
   - ç»Ÿä¸€ `.env` æ–‡ä»¶ç®¡ç†
   - æ”¯æŒå¤šç¯å¢ƒé…ç½®

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

7. **ä¸­é—´ä»¶é›†æˆ**
   - é›†æˆ CodeBERT è¿›è¡Œä»£ç è´¨é‡åˆ†æ
   - æ·»åŠ æ¼æ´æ£€æµ‹æ¨¡å‹
   - å¾®è°ƒæ¨¡å‹è¿›è¡Œè®ºæ–‡åˆ†ç±»

8. **Streamlit è°ƒè¯•ç•Œé¢**
   - ä¸ºæ¯ä¸ª Agent åˆ›å»ºç‹¬ç«‹åº”ç”¨
   - æ–¹ä¾¿å•ç‹¬æµ‹è¯•å’Œè°ƒä¼˜

---

## ğŸ› ï¸ å…·ä½“å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šé‡æ„ Agent ä¸ºèŠ‚ç‚¹åŒ–æ¶æ„

**ç›®æ ‡æ–‡ä»¶ç»“æ„**ï¼š

```
agents/
â”œâ”€â”€ research_agent/
â”‚   â”œâ”€â”€ agent.py              # ä¸»é€»è¾‘
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”œâ”€â”€ paper_search_node.py
â”‚   â”‚   â”œâ”€â”€ metadata_extract_node.py
â”‚   â”‚   â””â”€â”€ github_extract_node.py
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ acm_search.py
â”‚   â”‚   â”œâ”€â”€ ieee_search.py
â”‚   â”‚   â””â”€â”€ arxiv_search.py
â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â””â”€â”€ prompts.py
â”‚   â””â”€â”€ state/
â”‚       â””â”€â”€ state.py
â”œâ”€â”€ code_analysis_agent/
â”‚   â”œâ”€â”€ agent.py
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”œâ”€â”€ clone_node.py
â”‚   â”‚   â”œâ”€â”€ static_analysis_node.py
â”‚   â”‚   â””â”€â”€ security_scan_node.py
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ github_clone.py
â”‚   â”‚   â”œâ”€â”€ sonarqube.py
â”‚   â”‚   â””â”€â”€ bandit.py
â”‚   â””â”€â”€ ...
â””â”€â”€ forum_coordinator/
    â”œâ”€â”€ coordinator.py        # ä¸»æŒäººé€»è¾‘
    â”œâ”€â”€ monitor.py            # æ—¥å¿—ç›‘æ§
    â””â”€â”€ communication.py      # Agent é€šä¿¡åè®®
```

**ä»£ç ç¤ºä¾‹**ï¼š

```python
# agents/research_agent/nodes/paper_search_node.py
class PaperSearchNode(BaseNode):
    async def execute(self, state):
        query = state['query']
        conference = state['conference']
        
        # ä½¿ç”¨å·¥å…·æœç´¢è®ºæ–‡
        tool = self.tools[f'{conference}_search']
        papers = await tool.search(query)
        
        # æ›´æ–°çŠ¶æ€
        state['papers'] = papers
        return state
```

### æ–¹æ¡ˆ 2ï¼šå®ç° Forum Coordinator

**æ ¸å¿ƒé€»è¾‘**ï¼š

```python
# agents/forum_coordinator/coordinator.py
class ForumCoordinator:
    def __init__(self, agents: List[BaseAgent]):
        self.agents = agents
        self.moderator = ModeratorLLM()  # ä¸»æŒäºº LLM
        self.forum_log = []
    
    async def coordinate(self, task):
        """åè°ƒå¤šä¸ª Agent å®Œæˆä»»åŠ¡"""
        
        # 1. ä»»åŠ¡åˆ†è§£
        subtasks = await self.moderator.decompose(task)
        
        # 2. Agent æ‰§è¡Œ
        results = {}
        for subtask in subtasks:
            agent = self._select_agent(subtask)
            result = await agent.process(subtask)
            results[subtask.id] = result
            self.forum_log.append({
                'agent': agent.name,
                'subtask': subtask,
                'result': result
            })
        
        # 3. è®ºå›è¾©è®º
        debate_result = await self._forum_debate(results)
        
        # 4. ç”Ÿæˆæœ€ç»ˆç»“è®º
        conclusion = await self.moderator.synthesize(debate_result)
        
        return conclusion
    
    async def _forum_debate(self, results):
        """Agent è®ºå›è¾©è®º"""
        rounds = 3
        for round in range(rounds):
            # æ¯ä¸ª Agent å¯¹å…¶ä»– Agent çš„ç»“æœæå‡ºè´¨ç–‘
            critiques = {}
            for agent_name, result in results.items():
                other_agents = [a for a in self.agents if a.name != agent_name]
                for critic in other_agents:
                    critique = await critic.critique(result)
                    critiques[f'{critic.name}_on_{agent_name}'] = critique
            
            # ä¸»æŒäººæ€»ç»“
            summary = await self.moderator.summarize_debate(critiques)
            
            # Agent æ ¹æ®æ‰¹è¯„ä¿®æ­£ç»“æœ
            for agent in self.agents:
                if agent.name in results:
                    results[agent.name] = await agent.revise(
                        results[agent.name], 
                        critiques
                    )
        
        return results
```

### æ–¹æ¡ˆ 3ï¼šReport IR æ¶æ„

**JSON Schema å®šä¹‰**ï¼š

```json
{
  "document": {
    "meta": {
      "title": "è®ºæ–‡ä»£ç åˆ†ææŠ¥å‘Š",
      "author": "PaperBot",
      "timestamp": "2024-12-01T15:00:00Z"
    },
    "sections": [
      {
        "type": "summary",
        "title": "æ‰§è¡Œæ‘˜è¦",
        "blocks": [
          {
            "type": "paragraph",
            "content": "æœ¬æŠ¥å‘Šåˆ†æäº†..."
          },
          {
            "type": "list",
            "items": ["å…³é”®å‘ç°1", "å…³é”®å‘ç°2"]
          }
        ]
      },
      {
        "type": "code_analysis",
        "title": "ä»£ç è´¨é‡åˆ†æ",
        "blocks": [
          {
            "type": "table",
            "headers": ["æŒ‡æ ‡", "æ•°å€¼", "è¯„çº§"],
            "rows": [...]
          },
          {
            "type": "chart",
            "chart_type": "bar",
            "data": {...}
          }
        ]
      }
    ]
  }
}
```

**æ¸²æŸ“å™¨å®ç°**ï¼š

```python
# renderers/markdown_renderer.py
class MarkdownRenderer:
    def render(self, document_ir):
        md = f"# {document_ir['meta']['title']}\n\n"
        
        for section in document_ir['sections']:
            md += f"## {section['title']}\n\n"
            
            for block in section['blocks']:
                if block['type'] == 'paragraph':
                    md += f"{block['content']}\n\n"
                elif block['type'] == 'list':
                    for item in block['items']:
                        md += f"- {item}\n"
                    md += "\n"
                elif block['type'] == 'table':
                    md += self._render_table(block)
                elif block['type'] == 'chart':
                    md += self._render_chart(block)
        
        return md
```

---

## ğŸ“ å­¦ä¹ ä»·å€¼

### 1. ç³»ç»Ÿè®¾è®¡ç†å¿µ

BettaFish çš„è®¾è®¡å“²å­¦å€¼å¾—æ·±å…¥å­¦ä¹ ï¼š

- **æ¨¡å—åŒ–ä¼˜å…ˆ**ï¼šæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€æ›¿æ¢
- **æ¥å£æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„ Agent/Node/Tool æ¥å£
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šLLMã€ä¸­é—´ä»¶ã€å·¥å…·å„å¸å…¶èŒ
- **å¯æ‰©å±•æ€§**ï¼šè½»æ¾æ·»åŠ æ–°çš„ Agent/Node/Tool

### 2. å·¥ç¨‹æœ€ä½³å®è·µ

- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ Pydantic è¿›è¡Œé…ç½®ç®¡ç†
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é‡è¯•æœºåˆ¶ï¼ˆ`utils/retry_helper.py`ï¼‰
- **æ—¥å¿—ç®¡ç†**ï¼šå®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ
- **æµ‹è¯•è¦†ç›–**ï¼šå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•

### 3. å¤š Agent åä½œæ¨¡å¼

- **è®ºå›æœºåˆ¶**ï¼šé€šè¿‡è¾©è®ºæå‡å†³ç­–è´¨é‡
- **ä¸»æŒäººæ¨¡å‹**ï¼šåè°ƒ Agent é—´çš„äº¤äº’
- **çŠ¶æ€å…±äº«**ï¼šè·¨ Agent çš„çŠ¶æ€ç®¡ç†

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„ï¼ˆ1-2å‘¨ï¼‰

1. **é‡æ„ BaseAgent**
   - å¼•å…¥ `nodes/` æ¶æ„
   - ç»Ÿä¸€ `tools/`ã€`prompts/` ç›®å½•ç»“æ„
   - å®ç°çŠ¶æ€ç®¡ç†æœºåˆ¶

2. **åˆ›å»º Prompt åº“**
   - æå–ç°æœ‰ Prompt åˆ°ç‹¬ç«‹æ–‡ä»¶
   - ä¸ºä¸åŒä»»åŠ¡è®¾è®¡ä¸“é—¨çš„ Prompt

3. **ç»Ÿä¸€é…ç½®ç®¡ç†**
   - è¿ç§»åˆ° Pydantic + `.env`
   - æ”¯æŒå¤šç¯å¢ƒé…ç½®

### ç¬¬äºŒé˜¶æ®µï¼šAgent åä½œæœºåˆ¶ï¼ˆ2-3å‘¨ï¼‰

1. **å®ç° ForumCoordinator**
   - åˆ›å»ºä¸»æŒäºº Agent
   - å®ç° Agent é—´é€šä¿¡åè®®
   - å¼•å…¥è¾©è®ºæœºåˆ¶

2. **ä¸ºç°æœ‰ Agent æ·»åŠ èŠ‚ç‚¹**
   - ResearchAgent â†’ PaperSearchNode + MetadataExtractNode
   - CodeAnalysisAgent â†’ CloneNode + StaticAnalysisNode

### ç¬¬ä¸‰é˜¶æ®µï¼šæŠ¥å‘Šç”Ÿæˆå¢å¼ºï¼ˆ2-3å‘¨ï¼‰

1. **è®¾è®¡ Report IR**
   - å®šä¹‰ JSON Schema
   - å®ç°æ ¡éªŒå™¨

2. **å®ç°å¤šè½®æŠ¥å‘Šç”Ÿæˆ**
   - æ¨¡æ¿é€‰æ‹© â†’ å¸ƒå±€è®¾è®¡ â†’ ç« èŠ‚ç”Ÿæˆ

3. **æ·»åŠ æ¸²æŸ“å™¨**
   - Markdown/HTML/PDF å¯¼å‡º

### ç¬¬å››é˜¶æ®µï¼šå·¥å…·é›†æ‰©å±•ï¼ˆæŒç»­ï¼‰

1. **è®ºæ–‡æœç´¢å·¥å…·**
   - ACMã€IEEEã€arXiv ç­‰å¤šæºæœç´¢

2. **ä»£ç åˆ†æå·¥å…·**
   - SonarQubeã€Banditã€Pylint ç­‰é›†æˆ

3. **ä¸­é—´ä»¶é›†æˆ**
   - CodeBERTã€æ¼æ´æ£€æµ‹æ¨¡å‹ç­‰

---

## ğŸ“š å‚è€ƒèµ„æº

- **BettaFish å®˜æ–¹æ–‡æ¡£**ï¼šhttps://github.com/666ghj/BettaFish
- **Deep Search Agent Demo**ï¼šhttps://github.com/666ghj/DeepSearchAgent-Demoï¼ˆåˆå­¦è€…å‹å¥½ï¼‰
- **Lç«™è®¨è®º**ï¼šhttps://linux.do/t/topic/1009280

---

## ğŸ’¡ æ€»ç»“

BettaFish é¡¹ç›®ä¸º PaperBot æä¾›äº†æå…·ä»·å€¼çš„å‚è€ƒï¼š

1. **æœ€å…·ä»·å€¼**ï¼šAgent è®ºå›åä½œæœºåˆ¶ + èŠ‚ç‚¹åŒ–æ¶æ„
2. **æ˜“äºå®æ–½**ï¼šPrompt æ¨¡æ¿åŒ–ç®¡ç† + ç»Ÿä¸€é…ç½®ç®¡ç†
3. **é•¿æœŸæ”¶ç›Š**ï¼šReport IR æ¶æ„ + å·¥å…·é›†æ’ä»¶åŒ–
4. **å·¥ç¨‹è´¨é‡**ï¼šæ¨¡å—åŒ–è®¾è®¡ + å®Œå–„çš„æµ‹è¯•è¦†ç›–

å»ºè®®ä»**åŸºç¡€æ¶æ„é‡æ„**å¼€å§‹ï¼Œé€æ­¥å¼•å…¥**è®ºå›åä½œæœºåˆ¶**å’Œ**æŠ¥å‘Šç”Ÿæˆå¢å¼º**ï¼Œæœ€ç»ˆæ‰“é€ ä¸€ä¸ªæ›´åŠ æ™ºèƒ½ã€æ¨¡å—åŒ–ã€å¯æ‰©å±•çš„å­¦æœ¯è®ºæ–‡åˆ†æç³»ç»Ÿã€‚
